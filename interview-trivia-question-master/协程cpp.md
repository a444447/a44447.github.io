# 协程入门

在多任务系统中，操作系统会通过调度机制调整个各个进程的状态，在这个调整过程中，就涉及进程的上下文切换：

+ 上下文保存：把当前进程的上下文信息，比如程序计数器，寄存器，栈指针，内存信息都保存在PCB中
+ 选择新进程：根据调度算法选择新进程执行
+ 加载目标进程：从新进程的PCB中恢复上下文信息、

后来又诞生了新的基本运行单位，线程。线程相比于进程，同一个进程的线程之间由于共享了内存地址等信息，切换设计的上下文变更少，并且由于资源共享，所以创建线程的开销小。

不论是进程还是线程，其切换均需要系统调用，即操作系统需要陷入**内核态再返回用户态**。而系统调用是一种昂贵的操作，在对性有较高要求的场景下应该尽可能减少系统调用的次数。

## 协程使用场景

> 在了解协程使用场景前，我们需要知道在无协程的编程模式下存在什么问题。主要是针对 IO 密集型应用，如果是**同步阻塞 IO**，那么线程会在等待 IO 时被阻塞，这个过程可能会发生线程切换，如果是**同步非阻塞 IO**，线程也会因为轮询 IO 是否完成而浪费 CPU 资源，总之传统的同步 IO 效率非常底下。